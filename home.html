<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Assessment | Secure Engine</title>
    <style>
        :root { --primary: #0f172a; --accent: #3b82f6; --success: #10b981; --danger: #ef4444; }
        body { font-family: 'Segoe UI', sans-serif; background: #f8fafc; margin: 0; color: #1e293b; }
        
        /* Fixed Header with Proctoring Status */
        .exam-header { 
            background: var(--primary); color: white; padding: 1rem 5%; 
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .status-dot { height: 10px; width: 10px; background: var(--success); border-radius: 50%; display: inline-block; margin-right: 5px; animation: blink 1.5s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

        .container { max-width: 900px; margin: 40px auto; padding: 0 20px; }
        .quiz-card { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }

        /* Question Styling */
        .q-block { margin-bottom: 30px; padding: 20px; border-left: 4px solid #e2e8f0; background: #fcfcfc; transition: 0.3s; }
        .q-block:hover { border-left-color: var(--accent); background: #f8fafc; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .opt-label { 
            padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; 
            cursor: pointer; display: flex; align-items: center; font-size: 0.95rem;
        }
        .opt-label:hover { background: #eff6ff; border-color: var(--accent); }
        input[type="radio"] { margin-right: 10px; }

        /* Certificate Styling */
        #certificate { 
            display: none; text-align: center; border: 12px double var(--primary); 
            padding: 60px; background: white; position: relative;
            background-image: radial-gradient(#f1f5f9 1.5px, transparent 1.5px); background-size: 30px 30px;
        }
        .hash-code { font-family: 'Courier New', monospace; font-size: 0.8rem; color: #64748b; margin-top: 20px; word-break: break-all; }

        .btn { 
            background: var(--primary); color: white; padding: 15px 30px; 
            border: none; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1.1rem;
        }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }

        #fail-message { display: none; text-align: center; color: var(--danger); }

        @media print {
            nav, .exam-header, .btn, #examBox, #fail-message { display: none !important; }
            #certificate { display: block !important; border: 5px solid black; margin: 0; position: absolute; top: 0; width: 100%; }
        }
    </style>
</head>
<body>

<div class="exam-header">
    <div style="font-weight: bold;">[SECURE_EXAM_ENVIRONMENT]</div>
    <div id="timer">Time Remaining: 10:00</div>
    <div><span class="status-dot"></span> AI Proctor: ACTIVE</div>
</div>

<div class="container">
    <div class="quiz-card" id="examBox">
        <div style="margin-bottom: 30px;">
            <h2>Final Certification Assessment</h2>
            <p><strong>Candidate Name:</strong> <input type="text" id="studentName" placeholder="Enter Full Name" style="padding: 8px; width: 250px; border: 1px solid #ccc; border-radius: 4px;"></p>
            <p style="font-size: 0.9rem; color: #64748b;">Threshold: 70% required to pass. Questions are randomized for integrity.</p>
        </div>

        <div id="quiz-container">
            </div>

        <button class="btn" onclick="processResult()">Submit Final Assessment</button>
    </div>

    <div id="fail-message" class="quiz-card">
        <h1 style="font-size: 4rem;">‚ùå</h1>
        <h2>Assessment Incomplete</h2>
        <p id="score-report"></p>
        <p>You did not meet the 70% threshold. Please review the curriculum and try again.</p>
        <button class="btn" style="background: var(--accent);" onclick="location.reload()">Restart Exam</button>
    </div>

    <div id="certificate">
        <p style="letter-spacing: 5px; color: var(--accent); font-weight: bold; margin: 0;">OFFICIAL TRANSCRIPT</p>
        <h1 style="font-size: 3.5rem; margin: 20px 0 10px;" id="outName">CANDIDATE NAME</h1>
        <p style="font-size: 1.2rem;">Has successfully demonstrated advanced mastery in</p>
        <h2 style="font-size: 2rem; color: var(--primary); margin-bottom: 0;">AI PROCTORING & DIGITAL INTEGRITY</h2>
        <p>A rigorous, proctored competency-based assessment.</p>
        
        <div style="margin: 40px auto; width: 60%; border-top: 1px solid #cbd5e1; padding-top: 20px;">
            <p><strong>Verified Score:</strong> <span id="finalScore"></span>%</p>
            <p><strong>Certificate ID:</strong> <span id="certID"></span></p>
            <p><strong>Issued on:</strong> <span id="certDate"></span></p>
        </div>

        <div class="hash-code">AUTHENTICATION HASH: <span id="certHash"></span></div>
        <button class="btn" onclick="window.print()" style="width: auto; margin-top: 30px;">Save as PDF / Print</button>
    </div>
</div>

<script>
    const questionBank = [
        { q: "What is the primary purpose of a 'Secure Browser' during an exam?", a: "To prevent unauthorized resource access", options: ["To speed up internet connection", "To prevent unauthorized resource access", "To record audio", "To change display resolution"] },
        { q: "Which cryptographic algorithm is commonly used for secure credential hashing?", a: "SHA-256", options: ["AES-128", "SHA-256", "MD5", "Base64"] },
        { q: "What does AI gaze-tracking monitor?", a: "Eye movements and focus points", options: ["Typing speed", "Eye movements and focus points", "Background noise", "Mouse DPI"] },
        { q: "A 'False Positive' in proctoring refers to:", a: "Identifying a legitimate action as cheating", options: ["Passing an exam easily", "A system crash", "Identifying a legitimate action as cheating", "A student failing the exam"] },
        { q: "What is 'Biometric Authentication'?", a: "Identity verification via physical traits", options: ["Password protection", "Identity verification via physical traits", "Two-factor SMS", "Encrypted email"] },
        // Add 15 more questions similarly to reach 20
    ];

    // Randomized questions on load
    const shuffledQuestions = questionBank.sort(() => 0.5 - Math.random()).slice(0, 5); // Using 5 for demo, set to 20 for full

    function initQuiz() {
        const container = document.getElementById('quiz-container');
        shuffledQuestions.forEach((item, idx) => {
            container.innerHTML += `
                <div class="q-block">
                    <p><strong>Question ${idx + 1}:</strong> ${item.q}</p>
                    <div class="options-grid">
                        ${item.options.map(opt => `
                            <label class="opt-label">
                                <input type="radio" name="q${idx}" value="${opt}"> ${opt}
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;
        });
    }

    // Timer Logic
    let timeLeft = 600; // 10 minutes
    const timerDisplay = document.getElementById('timer');
    const timerInterval = setInterval(() => {
        timeLeft--;
        let mins = Math.floor(timeLeft / 60);
        let secs = timeLeft % 60;
        timerDisplay.innerText = `Time Remaining: ${mins}:${secs < 10 ? '0' : ''}${secs}`;
        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            processResult();
        }
    }, 1000);

    function processResult() {
        const name = document.getElementById('studentName').value;
        if (!name) { alert("Please enter your name."); return; }

        let score = 0;
        shuffledQuestions.forEach((item, idx) => {
            const selected = document.querySelector(`input[name="q${idx}"]:checked`);
            if (selected && selected.value === item.a) score++;
        });

        const percent = (score / shuffledQuestions.length) * 100;
        document.getElementById('examBox').style.display = 'none';
        clearInterval(timerInterval);

        if (percent >= 70) {
            showSuccess(name, percent);
        } else {
            showFail(percent);
        }
    }

    function showSuccess(name, score) {
        document.getElementById('certificate').style.display = 'block';
        document.getElementById('outName').innerText = name.toUpperCase();
        document.getElementById('finalScore').innerText = score;
        document.getElementById('certID').innerText = 'ACAD-' + Math.random().toString(36).substr(2, 9).toUpperCase();
        document.getElementById('certDate').innerText = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        
        // Generate a pseudo-hash for "Viva" proof
        const rawHash = btoa(name + Date.now()).substr(0, 32);
        document.getElementById('certHash').innerText = `SHA256::${rawHash.toUpperCase()}`;
    }

    function showFail(score) {
        document.getElementById('fail-message').style.display = 'block';
        document.getElementById('score-report').innerText = `You scored ${score}%.`;
    }

    window.onload = initQuiz;
</script>
</body>
</html>
